################################################################
# VARIABLES
# TODO: make local, instead of making env variables
################################################################

tmuxConfig="~/.tmux.conf"
tmuxLocalConfig="~/.tmux.local.conf"
tmuxTheme="~/dotfiles/src/themes/tmuxline.conf"
tmuxCords="~/lib/tmux-cords.sh"
tmuxPlugins="~/.tmux/plugins"


################################################################
# SETTINGS
################################################################

set -g default-terminal "$TERM"
# set -g default-command "$SHELL"
# set -g default-shell "$SHELL"

# use vi mode
set -g mode-keys vi
setw -g xterm-keys on

# 0 is far, far away
set -g base-index 1
set -g pane-base-index 1

# directly expose pane titles
set -g set-titles on
set -g set-titles-string "#S: #T"

setw -g monitor-activity on
set -g visual-activity off

# urgency hints
set -g bell-action any
set -g bell-on-alert on

# reindex windows
set -g renumber-windows on

# only resize shared windows
setw -g aggressive-resize on

# shell vi-mode
set -g @shell_mode "vi"

# terminal overrides
# set -g terminal-overrides '*88col*:colors=88,*256col*:colors=256,xterm*:XT:Ms=\E]52;%p1%s;%p2%s\007:Cs=\E]12;%p1%s\007:Cr=\E]112\007:Ss=\E]50;CursorShape=%?%p1%{3}%<%t%{0}%e%p1%{2}%-%;%d\007'
# set -ga terminal-overrides ",rxvt*:XT"

# mice infestation
set -g mouse on


################################################################
# THEME
################################################################

# tmuxline
if-shell "test -f $tmuxTheme" "source $tmuxTheme"


################################################################
# MAPPINGS
################################################################


################
## PREFIX
################

unbind C-b
set -g prefix C-Space
# nested prefix
bind C-Space send-prefix
bind Space send-prefix


################
## SESSIONS
################

bind s run "$tmuxCords session"


################
## TABS (windows)
################

bind t run "$tmuxCords tab"


################
## BUFFERS (panes)
################

bind b run "$tmuxCords buffer"


################
## MISC
################

# same command prompt alias as vim
bind \; command-prompt

# force a reload of the config file
bind r if-shell "test -f $tmuxConfig" "source $tmuxConfig\; display 'Config reloaded.'"

# time
bind T clock-mode


# NAVIGATING

# Smart pane switching with awareness of vim splits
isVim="tmux display -p '#{pane_current_command} #T' | grep -iqE '(vim|VIM)'"
bind -n C-j if-shell "$isVim" "send C-j" "select-pane -D"
bind -n C-k if-shell "$isVim" "send C-k" "select-pane -U"
bind -n C-h if-shell "$isVim" "send C-h" "select-pane -L"
bind -n C-l if-shell "$isVim" "send C-l" "select-pane -R"
bind -n C-\ if-shell "$isVim" "send C-\\" "select-pane -l"

# fallback for weird situations
bind -r Up select-pane -U
bind -r Down select-pane -D
bind -r Left select-pane -L
bind -r Right select-pane -R

bind \ last-pane
bind Tab last-window


# SWAPPING

bind -r S-Down swap-pane -D
bind -r S-Up swap-pane -U
bind -r S-Left swap-pane -U
bind -r S-Right swap-pane -D


################
## COPY PASTA
################

bind c copy-mode
bind P paste-buffer
bind -t vi-copy v begin-selection
bind -t vi-copy i cancel
bind -t vi-copy I cancel
bind -t vi-copy a cancel
bind -t vi-copy A cancel
bind -t vi-copy c cancel
bind -t vi-copy C cancel


################
## MOUSES
################

# turn mouse on
bind M \
	set -g mouse on \;\
	display "Mouse: ON"

# turn mouse off
bind m \
	set -g mouse off \;\
	display "Mouse: OFF"


################
## PLUGINS
################

# installed plugins
set -g @tpm_plugins "\
	tmux-plugins/tpm \
	tmux-plugins/tmux-sensible \
	tmux-plugins/tmux-yank \
	tmux-plugins/tmux-copycat \
	tmux-plugins/tmux-open \
	rosshadden/tmux-pain-control \
	tmux-plugins/tmux-sessionist \
	tmux-plugins/tmux-sidebar \
	tmux-plugins/tmux-urlview \
	tmux-plugins/tmux-fpp \
"

# tmux-pain-control
# set -g @pane_resize "10"

# tmux-sidebar
set -g @sidebar-tree "Escape"
set -g @sidebar-tree-command "vifm -c 'only' ."
set -g @sidebar-tree-pager "cat"
set -g @sidebar-tree-width "30"


################
## LOCAL
################

# load local config
if-shell "test -f $tmuxLocalConfig" "source $tmuxLocalConfig"


################
## INIT
################

# init TMUX plugin manager.
run-shell "$tmuxPlugins/tpm/tpm"
