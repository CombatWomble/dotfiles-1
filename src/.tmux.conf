################################################################
# SETTINGS
################################################################

set -g default-terminal "rxvt-unicode-256color"
# set -g default-command "$SHELL"
# set -g default-shell "$SHELL"

# use vi mode
set -g mode-keys vi
setw -g xterm-keys on

# 0 is far, far away
set -g base-index 1
set -g pane-base-index 1

# directly expose pane titles
set -g set-titles on
set -g set-titles-string "#T"

setw -g monitor-activity on
set -g visual-activity off

# urgency hints
set -g bell-action any
set -g bell-on-alert on

# reindex windows
set -g renumber-windows on

# only resize shared windows
setw -g aggressive-resize on

# shell vi-mode
set -g @shell_mode 'vi'

# terminal overrides
# set -g terminal-overrides '*88col*:colors=88,*256col*:colors=256,xterm*:XT:Ms=\E]52;%p1%s;%p2%s\007:Cs=\E]12;%p1%s\007:Cr=\E]112\007:Ss=\E]50;CursorShape=%?%p1%{3}%<%t%{0}%e%p1%{2}%-%;%d\007'
# set -ga terminal-overrides ",rxvt*:XT"

# mice infestation
set -g mode-mouse on
set -g mouse-utf8 off
set -g mouse-resize-pane on
set -g mouse-select-pane on
set -g mouse-select-window on


################################################################
# THEME
################################################################

# tmuxline
theme="~/dotfiles/src/themes/tmuxline.conf"
if-shell "test -f $theme" "source $theme"


################################################################
# MAPPINGS
################################################################


################
## PREFIX
################

unbind C-b
set -g prefix C-Space
# nested prefix
bind C-Space send-prefix
bind Space send-prefix


################
## SESSIONS
################

bind s run "~/lib/tmux-cords.sh session"


################
## TABS (windows)
################

bind t run "~/lib/tmux-cords.sh tab"


################
## BUFFERS (panes)
################

bind b run "~/lib/tmux-cords.sh buffer"


################
## MISC
################

# same command prompt alias as vim
bind \; command-prompt

# force a reload of the config file
bind r source ~/.tmux.conf\; display "Config reloaded."

# time
bind T clock-mode


# NAVIGATING

# Smart pane switching with awareness of vim splits
bind -n C-j run "(tmux display -p '#T' | grep -iqE '(^vim| - VIM$)' && tmux send C-j) || tmux select-pane -D || :"
bind -n C-k run "(tmux display -p '#T' | grep -iqE '(^vim| - VIM$)' && tmux send C-k) || tmux select-pane -U || :"
bind -n C-h run "(tmux display -p '#T' | grep -iqE '(^vim| - VIM$)' && tmux send C-h) || tmux select-pane -L || :"
bind -n C-l run "(tmux display -p '#T' | grep -iqE '(^vim| - VIM$)' && tmux send C-l) || tmux select-pane -R || :"
bind -n C-\ run "(tmux display -p '#T' | grep -iqE '(^vim| - VIM$)' && tmux send 'C-\\') || tmux select-pane -l || :"

# fallback for weird situations
bind -r Up select-pane -U
bind -r Down select-pane -D
bind -r Left select-pane -L
bind -r Right select-pane -R

# previous buffer (since I stole ;)
bind \ last-pane


# SWAPPING

bind -r S-Down swap-pane -D
bind -r S-Up swap-pane -U
bind -r S-Left swap-pane -U
bind -r S-Right swap-pane -D


################
## COPY PASTA
################

bind Escape copy-mode
bind P paste-buffer
bind -t vi-copy v begin-selection
bind -t vi-copy i cancel
bind -t vi-copy I cancel
bind -t vi-copy a cancel
bind -t vi-copy A cancel
bind -t vi-copy c cancel
bind -t vi-copy C cancel


################
## MOUSES
################

# turn mouse on
bind M \
	set -g mode-mouse on \;\
	set -g mouse-resize-pane on \;\
	set -g mouse-select-pane on \;\
	set -g mouse-select-window on \;\
	display 'Mouse: ON'

# turn mouse off
bind m \
	set -g mode-mouse off \;\
	set -g mouse-resize-pane off \;\
	set -g mouse-select-pane off \;\
	set -g mouse-select-window off \;\
	display 'Mouse: OFF'


################
## PLUGINS
################

plugins="~/.tmux/plugins"

# installed plugins
set -g @tpm_plugins "\
	tmux-plugins/tpm \
	tmux-plugins/tmux-sensible \
	tmux-plugins/tmux-yank \
	tmux-plugins/tmux-copycat \
	tmux-plugins/tmux-open \
	tmux-plugins/tmux-pain-control \
	tmux-plugins/tmux-sessionist \
	tmux-plugins/tmux-sidebar \
	tmux-plugins/tmux-urlview \
	tmux-plugins/tmux-fpp \
"

# tmux-pain-control
set -g @pane_resize "10"

# tmux-sidebar
set -g @sidebar-tree-command 'vifm -c "only" .'
set -g @sidebar-tree-pager 'cat'
set -g @sidebar-tree-width '30'

# init TMUX plugin manager.
run-shell "$plugins/tpm/tpm"
